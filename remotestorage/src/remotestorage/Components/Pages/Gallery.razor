@page "/images"

@rendermode InteractiveServer


<h1>Images</h1>


<div class="gallery">
    @foreach (var image in ImageUrls)
    {
        <img src="@image" class="photo" />
    }
</div>

@code {
    private readonly string[] ImageUrls = new[]
    {
        "https://picsum.photos/600/400",
        "https://picsum.photos/400/600",
        "https://picsum.photos/500/500",
        "https://picsum.photos/700/500",
        "https://picsum.photos/400/300",
        "https://picsum.photos/500/700",
        "https://picsum.photos/600/400",
        "https://picsum.photos/400/600",
        "https://picsum.photos/500/500",
        "https://picsum.photos/700/500",
        "https://picsum.photos/400/300",
        "https://picsum.photos/500/700",
        "https://picsum.photos/450/450",
        "https://picsum.photos/300/400",
        "https://picsum.photos/600/600",
        "https://picsum.photos/500/350",
        "https://picsum.photos/450/450",
        "https://picsum.photos/300/400",
        "https://picsum.photos/600/600",
        "https://picsum.photos/500/350"
    };

    private List<Image> Images = new();

    [Inject] public HttpClient Http { get; set; } = default!;
    [Inject] public IConfiguration Configuration { get; set; } = default!;

    protected override async Task OnInitializedAsync()
    {
        var apiBaseUrl = Configuration["API_BASE_URL"] ?? "http://localhost:5050";
        Http.BaseAddress = new Uri(apiBaseUrl);


        await LoadImages();
    }

    private async Task LoadImages()
    {
        try
        {
            Images = await Http.GetFromJsonAsync<List<Image>>("image")
            ?? new List<Image>();
            Console.WriteLine($"Loaded {Images.Count} images.");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading images: {ex.Message}");
            Images = new List<Image>(); // fallback to empty list
        }
    }

    private async Task DeleteImage(int id)
    {
        Console.WriteLine($"Delete clicked for image {id}");

        try
        {
            var response = await Http.DeleteAsync($"image/{id}");

            if (response.IsSuccessStatusCode)
            {
                var img = Images.FirstOrDefault(i => i.id == id);
                if (img != null)
                {
                    Images.Remove(img);
                    StateHasChanged();
                }

                Console.WriteLine($"Image {id} deleted successfully.");
            }
            else
            {
                Console.WriteLine($"Failed to delete image {id}: {response.StatusCode}");
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error deleting image {id}: {ex.Message}");
        }
    }

    bool HasToggledAddImage = false;
    public void ToggleAddImage()
    {
        HasToggledAddImage = !HasToggledAddImage;
    }

    public class Image
    {
        public int id { get; set; }
        public string? name { get; set; }
        public string? url { get; set; }
    }
}